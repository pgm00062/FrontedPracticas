# üöÄ Gu√≠a Completa: Conectar Frontend Next.js con Microservicios Client y Merchant

## ‚úÖ Estado Actual
‚úÖ Frontend Next.js configurado con TypeScript y Tailwind  
‚úÖ React Query instalado y configurado  
‚úÖ Axios configurado con interceptores JWT  
‚úÖ Componente TestConnection creado y funcionando  
‚úÖ Servicios espec√≠ficos para Client y Merchant implementados  
‚úÖ Variables de entorno configuradas correctamente  
‚úÖ Sistema compilando sin errores  
‚úÖ Tipos TypeScript actualizados para MerchantDynamoEntity y ClientDynamoEntity  
‚úÖ Enum MerchantType definido correctamente  
‚úÖ Endpoints de Client actualizados seg√∫n tu ClientController real  
‚úÖ ClientService actualizado con m√©todos espec√≠ficos de tu API  
‚úÖ Endpoints de Merchant actualizados seg√∫n tu MerchantController real  
‚úÖ MerchantService actualizado con m√©todos espec√≠ficos de tu API  
‚úÖ **CONECTIVIDAD B√ÅSICA FUNCIONANDO PERFECTAMENTE**  
‚úÖ **Health checks operativos en ambos microservicios**  

## üèóÔ∏è Tu Arquitectura de Microservicios
- **Client Service:** http://localhost:8080
- **Merchant Service:** http://localhost:8081

## üîß Configuraci√≥n del Backend Spring Boot

### 1. A√±adir CORS Configuration a AMBOS microservicios
Copia el archivo `docs/CorsConfig.java` a cada proyecto Spring Boot:
```
src/main/java/com/tupackage/config/CorsConfig.java
```

### 2. A√±adir Endpoint de Health Check a AMBOS microservicios

**üìÅ Los archivos est√°n listos en tu carpeta `docs/`:**
- `docs/HealthController-Client.java` - Para Client Service (puerto 8080)
- `docs/HealthController-Merchant.java` - Para Merchant Service (puerto 8081)

**Para Client Service (puerto 8080):**
1. Copia `docs/HealthController-Client.java` a tu proyecto Client
2. Ubicaci√≥n: `src/main/java/com/tupackage/controller/HealthController.java`
3. **Cambia `com.tupackage` por el package real de tu proyecto**

**Para Merchant Service (puerto 8081):**
1. Copia `docs/HealthController-Merchant.java` a tu proyecto Merchant  
2. Ubicaci√≥n: `src/main/java/com/tupackage/controller/HealthController.java`
3. **Cambia `com.tupackage` por el package real de tu proyecto**

**C√≥digo de ejemplo:**
```java
// Para Client Service
@RestController
public class HealthController {
    @GetMapping("/health")
    public String health() {
        return "OK - Client Service funcionando en puerto 8080";
    }
}

// Para Merchant Service
@RestController
public class HealthController {
    @GetMapping("/health")
    public String health() {
        return "OK - Merchant Service funcionando en puerto 8081";
    }
}
```

## üöÄ Ejecutar y Probar

### 1. Iniciar tus Microservicios Spring Boot
```bash
# En tu proyecto Client Service
./mvnw spring-boot:run

# En tu proyecto Merchant Service  
./mvnw spring-boot:run
```

### 2. Iniciar Frontend
```bash
npm run dev
```
La aplicaci√≥n estar√° disponible en: http://localhost:3000

### 3. Probar Conexi√≥n
1. **Abre tu navegador** en http://localhost:3000
2. **Haz clic en "Test Client Service"** - deber√≠a mostrar ‚úÖ si est√° funcionando
3. **Haz clic en "Test Merchant Service"** - deber√≠a mostrar ‚úÖ si est√° funcionando

## üìÅ Estructura de Archivos Actualizada

```
src/
‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TestConnection/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.tsx          # ‚úÖ Componente de prueba funcionando
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UserManagement/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.tsx          # üöß Simplificado, en desarrollo
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useApi.ts              # ‚úÖ Redirige a useClientMerchantApi
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useClientMerchantApi.ts # ‚úÖ Hooks espec√≠ficos implementados
‚îÇ   ‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ReactQueryProvider.tsx # ‚úÖ Configurado
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ apiConfig.ts           # ‚úÖ Endpoints Client/Merchant
‚îÇ       ‚îî‚îÄ‚îÄ httpClient.ts          # ‚úÖ Clientes espec√≠ficos
‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ userService.ts         # ‚úÖ Redirige a clientMerchantService
‚îÇ       ‚îî‚îÄ‚îÄ clientMerchantService.ts # ‚úÖ Servicios espec√≠ficos
‚îî‚îÄ‚îÄ app/
    ‚îú‚îÄ‚îÄ layout.tsx                 # ‚úÖ Con React Query Provider
    ‚îî‚îÄ‚îÄ page.tsx                   # ‚úÖ Usando TestConnection
```

## üîÑ Pr√≥ximos Pasos

### PASO 1: Verificar Conexi√≥n B√°sica ‚úÖ
- [x] TestConnection funcionando
- [x] Variables de entorno configuradas
- [x] Servicios compilando sin errores

### PASO 2: Endpoints Actualizados ‚úÖ
Los endpoints de Client ya est√°n actualizados seg√∫n tu ClientController:

```typescript
export const API_ENDPOINTS = {
  CLIENTS: {
    CREATE: '/clients',                                 // POST - Crear cliente
    GET_BY_ID: (id) => `/clients/${id}`,               // GET - Obtener cliente
    GET_BY_ID_SIMPLE: (id) => `/clients/${id}?simpleOutput=true`, // GET - Cliente simple
    GET_BY_EMAIL: '/clients/email',                    // GET - Buscar por email (?email=...)
    FIND_BY_NAME: '/clients/name',                     // GET - Buscar por nombre (?name=...)
    UPDATE: (id) => `/clients/${id}`,                  // PUT - Actualizar cliente
    MERCHANT_EXISTS: (id) => `/clients/merchant-exists/${id}`, // GET - Verificar merchant
    HEALTH: '/health',                                 // GET - Health check
  },
  MERCHANTS: {
    // ‚úÖ Actualizados seg√∫n tu MerchantController real
    CREATE: '/clients',                                         // POST - Crear merchant
    GET_BY_ID: (clientId, merchantId) => `/clients/${clientId}/merchants/${merchantId}`, // GET
    GET_BY_ID_SIMPLE: (clientId, merchantId) => `/clients/${clientId}/merchants/${merchantId}?simpleOutput=true`,
    FIND_BY_NAME: '/clients/name',                             // GET - Buscar por nombre (?name=...)
    GET_BY_CLIENT_ID: (clientId) => `/clients/${clientId}/merchants`, // GET - Merchants de un cliente
    GET_BY_MERCHANT_ID: (merchantId) => `/clients/merchants/by-merchant-id/${merchantId}`, // GET
    UPDATE: (clientId, merchantId) => `/clients/${clientId}/merchants/${merchantId}`, // PUT
    EXISTS: (merchantId) => `/clients/merchants/${merchantId}/exists`, // GET - Verificar existencia
    HEALTH: '/health',                                         // GET - Health check
  },
};
```

### PASO 3: Servicios Client Disponibles ‚úÖ
Ya tienes estos m√©todos espec√≠ficos para tu ClientController:

```typescript
import { ClientService } from '../service/src/clientMerchantService';

// Crear cliente
const newClient = await ClientService.create({
  name: "Juan",
  surname: "P√©rez", 
  cifNifNie: "12345678X",
  phone: "600123456",
  email: "juan@example.com",
  age: "30"
});

// Obtener cliente por ID
const client = await ClientService.getById(1);

// Obtener cliente simple por ID
const simpleClient = await ClientService.getByIdSimple(1);

// Buscar por email
const clientByEmail = await ClientService.getByEmail("juan@example.com");

// Buscar por nombre
const clientsByName = await ClientService.findByName("Juan");

// Actualizar cliente
const updatedClient = await ClientService.update(1, clientData);

// Verificar si existe merchant
const merchantExists = await ClientService.merchantExists(123);

// Health check
const health = await ClientService.healthCheck();
```

### PASO 4: Servicios Merchant Disponibles ‚úÖ
Ya tienes estos m√©todos espec√≠ficos para tu MerchantController:

```typescript
import { MerchantService } from '../service/src/clientMerchantService';
import { MerchantType } from '../common/types/entities';

// Crear merchant
const newMerchant = await MerchantService.create({
  clientId: 1,
  name: "Mi Tienda",
  address: "Calle Principal 123",
  merchantType: MerchantType.MERCHANT_TYPE_PERSONAL_SERVICES
});

// Obtener merchant por ID (clientId y merchantId)
const merchant = await MerchantService.getById(1, 123);

// Obtener merchant simple por ID
const simpleMerchant = await MerchantService.getByIdSimple(1, 123);

// Buscar merchants por nombre
const merchantsByName = await MerchantService.findByName("Mi Tienda");

// Obtener todos los merchants de un cliente
const clientMerchants = await MerchantService.getByClientId(1);

// Obtener merchant por merchantId (sin clientId)
const merchantById = await MerchantService.getByMerchantId(123);

// Actualizar merchant
const updatedMerchant = await MerchantService.update(1, 123, {
  name: "Nueva Tienda",
  address: "Nueva Direcci√≥n",
  merchantType: "MERCHANT_TYPE_FINANCIAL_SERVICES"
});

// Verificar si existe merchant
const merchantExists = await MerchantService.exists(123);

// Health check
const health = await MerchantService.healthCheck();
```
Una vez que la conexi√≥n b√°sica funcione, puedes:

1. **Crear componentes espec√≠ficos** para Client y Merchant
2. **Usar los hooks ya implementados** en `useClientMerchantApi.ts`
3. **Expandir el UserManagement** para gesti√≥n completa

## üéØ Hooks Disponibles

Ya tienes estos hooks listos para usar:

```typescript
// Para Clients
import { 
  useClients,           // Obtener lista de clientes
  useClient,            // Obtener cliente por ID
  useCreateClient,      // Crear cliente
  useUpdateClient,      // Actualizar cliente
  useDeleteClient,      // Eliminar cliente
} from '../hooks/useClientMerchantApi';

// Para Merchants
import {
  useMerchants,         // Obtener lista de merchants
  useMerchant,          // Obtener merchant por ID
  useCreateMerchant,    // Crear merchant
  useUpdateMerchant,    // Actualizar merchant
  useDeleteMerchant,    // Eliminar merchant
} from '../hooks/useClientMerchantApi';

// Para Auth
import {
  useLogin,             // Login
  useLogout,            // Logout
} from '../hooks/useClientMerchantApi';
```

## üêõ Soluci√≥n de Problemas

### ‚ùå Error CORS
- Verifica que `CorsConfig.java` est√© en AMBOS microservicios
- Reinicia ambos servidores Spring Boot

### ‚ùå Error 404 en /health
- A√±ade el HealthController a ambos microservicios
- Verifica que los puertos sean correctos (8080 y 8081)

### ‚ùå Error de Conexi√≥n
- Aseg√∫rate de que AMBOS microservicios est√©n ejecut√°ndose
- Verifica las URLs en `.env.local`
- Usa F12 > Network para ver errores de red

## üìû ¬°CONEXI√ìN EXITOSA! ¬øQu√© sigue?

üéâ **¬°Ya tienes la conectividad b√°sica funcionando perfectamente!**

**Resultados de TestConnection:**
- ‚úÖ Client Service: "OK - Client Service funcionando en puerto 8080"
- ‚úÖ Merchant Service: "OK - Merchant Service funcionando en puerto 8081"

### üöÄ **Opciones para continuar:**

#### **1. Crear Interfaz de Usuario Completa**
- Formularios para crear/editar Clients y Merchants
- Tablas para listar y gestionar datos
- Integraci√≥n completa con React Query

#### **2. Implementar Funcionalidades CRUD**
- Usar los servicios ya configurados (`ClientService`, `MerchantService`)
- Crear componentes espec√≠ficos para cada entidad
- Manejar estados de loading, error y success

#### **3. A√±adir Autenticaci√≥n Completa**
- Login/logout con JWT
- Interceptores autom√°ticos para tokens
- Protecci√≥n de rutas

#### **4. Mejorar la Experiencia de Usuario**
- Notificaciones toast
- Validaci√≥n de formularios
- Paginaci√≥n y filtros

### üí° **¬øQu√© prefieres implementar primero?**

Dime qu√© te gustar√≠a hacer a continuaci√≥n y te ayudo a implementarlo. ¬°Tu setup b√°sico est√° 100% funcional! üöÄ
